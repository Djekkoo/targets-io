version: "2"

services:
  db:
    image: mongo:3.0
    ports:
     - "27017:27017"
    networks:
      - my-net
    volumes:
     - /var/lib/targets-io/mongo:/data/db
    restart: always
  graphite:
    image: dmoll1974/targets-io-graphite
    networks:
      - my-net
    ports:
     - "8090:80"
     - "2003:2003"
     - "8125:8125"
    volumes:
     - /var/lib/targets-io/graphite/log:/var/log
     - /var/lib/targets-io/graphite/storage:/opt/graphite/storage
    restart: always
  jenkins:
    image: dmoll1974/targets-io-jenkins
    networks:
      - my-net
    ports:
     - "8080:8080"
     - "50000:50000"
    restart: always
  redis:
    image: redis
    networks:
      - my-net
    ports:
     - "6379:6379"
    restart: always
  targetsio:
    image: dmoll1974/targets-io
    ports:
     - "3000:3000"
    networks:
      - my-net
    environment:
       MONGO_URL: "db:27017/targets-io"
       GRAPHITE_URL: "http://graphite"
       JENKINS_URL: "http://jenkins:8080"
       JENKINS_USER: "admin"
       JENKINS_PASSWORD: "targets-io"
       REDIS_HOST: "redis"
       REDIS_PORT: "6379"
    restart: always
    depends_on:
      - db
      - redis
      - graphite
  mean:
    image: dmoll1974/targets-io-demo-meanjs
    ports:
     - "3001:3000"
    environment:
       DB_1_PORT_27017_TCP_ADDR: "db:27017"
    networks:
      - my-net
    restart: always
    depends_on:
      - db
      - redis
      - graphite

networks:
  my-net:
    driver: bridge

